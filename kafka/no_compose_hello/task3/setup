#!/bin/bash

docker network create kafka-net

docker run -d \
  --name kafka-1 \
  --network kafka-net \
  -p 9092:9092 -p 29092:29092 \
  -e KAFKA_PROCESS_ROLES=broker,controller \
  -e KAFKA_LISTENERS=INTERNAL://:19092,EXTERNAL://:9092,CONTROLLER://kafka-1:29092 \
  -e KAFKA_ADVERTISED_LISTENERS=INTERNAL://kafka-1:19092,EXTERNAL://127.0.0.1:9092 \
  -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT \
  -e KAFKA_INTER_BROKER_LISTENER_NAME=INTERNAL \
  -e KAFKA_CONTROLLER_QUORUM_VOTERS="1@kafka-1:29092,2@kafka-2:29093,3@kafka-3:29094" \
  -e KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER \
  -e KAFKA_NODE_ID=1 \
  -e KAFKA_LOG_DIRS='/tmp/kraft-controller-logs' \
  -e CLUSTER_ID="MkU3OEVBNTcwNTJENDM2Qk" \
  confluentinc/cp-kafka:7.7.0


docker run -d \
  --name kafka-2 \
  --network kafka-net \
  -p 9093:9093 -p 29093:29093 \
  -e KAFKA_PROCESS_ROLES=broker,controller \
  -e KAFKA_LISTENERS=INTERNAL://:19093,EXTERNAL://:9093,CONTROLLER://kafka-2:29093 \
  -e KAFKA_ADVERTISED_LISTENERS=INTERNAL://kafka-2:19093,EXTERNAL://127.0.0.1:9093 \
  -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT \
  -e KAFKA_INTER_BROKER_LISTENER_NAME=INTERNAL \
  -e KAFKA_CONTROLLER_QUORUM_VOTERS="1@kafka-1:29092,2@kafka-2:29093,3@kafka-3:29094" \
  -e KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER \
  -e KAFKA_NODE_ID=2 \
  -e KAFKA_LOG_DIRS='/tmp/kraft-controller-logs' \
  -e CLUSTER_ID="MkU3OEVBNTcwNTJENDM2Qk" \
  confluentinc/cp-kafka:7.7.0


docker run -d \
  --name kafka-3 \
  --network kafka-net \
  -p 9094:9094 -p 29094:29094 \
  -e KAFKA_PROCESS_ROLES=broker,controller \
  -e KAFKA_LISTENERS=INTERNAL://:19094,EXTERNAL://:9094,CONTROLLER://kafka-3:29094 \
  -e KAFKA_ADVERTISED_LISTENERS=INTERNAL://kafka-3:19094,EXTERNAL://127.0.0.1:9094 \
  -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT \
  -e KAFKA_INTER_BROKER_LISTENER_NAME=INTERNAL \
  -e KAFKA_CONTROLLER_QUORUM_VOTERS="1@kafka-1:29092,2@kafka-2:29093,3@kafka-3:29094" \
  -e KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER \
  -e KAFKA_NODE_ID=3 \
  -e KAFKA_LOG_DIRS='/tmp/kraft-controller-logs' \
  -e CLUSTER_ID="MkU3OEVBNTcwNTJENDM2Qk" \
  confluentinc/cp-kafka:7.7.0


